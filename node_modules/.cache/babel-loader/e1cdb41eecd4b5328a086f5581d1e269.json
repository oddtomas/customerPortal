{"ast":null,"code":"// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { useEffect, useState } from 'react';\nimport { unstable_batchedUpdates } from 'react-dom';\nexport function createSingletonHandler(factory) {\n  var listeners = [];\n\n  var callback = function callback(value) {\n    unstable_batchedUpdates(function () {\n      for (var _i = 0, listeners_1 = listeners; _i < listeners_1.length; _i++) {\n        var listener = listeners_1[_i];\n        listener(value);\n      }\n    });\n  };\n\n  var cleanup;\n  return function useSingleton(listener) {\n    useEffect(function () {\n      if (listeners.length === 0) {\n        cleanup = factory(callback);\n      }\n\n      listeners.push(listener);\n      return function () {\n        listeners.splice(listeners.indexOf(listener), 1);\n\n        if (listeners.length === 0) {\n          cleanup();\n          cleanup = undefined;\n        }\n      }; // register handlers only on mount\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, []);\n  };\n}\nexport function createSingletonState(_a) {\n  var factory = _a.factory,\n      initialState = _a.initialState;\n  var useSingleton = createSingletonHandler(factory);\n  var value = initialState;\n  return function useSingletonState() {\n    var _a = useState(value),\n        state = _a[0],\n        setState = _a[1];\n\n    useSingleton(function (newValue) {\n      value = newValue;\n      setState(newValue);\n    });\n    return state;\n  };\n}","map":null,"metadata":{},"sourceType":"module"}